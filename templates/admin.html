{% extends "layout.html" %}
{% block content %}
  {% if login %}
    <h3>Admin login</h3>
    <form method="post">
      <div class="mb-3">
        <label class="form-label">Mot de passe admin</label>
        <input name="password" type="password" class="form-control" />
      </div>
      <button class="btn btn-primary" type="submit">Connexion</button>
    </form>
  {% else %}
    <div class="d-flex justify-content-between align-items-center">
      <h3>Admin — commandes</h3>
      <div>
        <a class="btn btn-outline-secondary" href="/admin/export">Export CSV</a>
        <a class="btn btn-danger" href="/admin/logout">Logout</a>
      </div>
    </div>

    <h5 class="mt-3">Total général ventes : {{ '%.2f' % total_general }} €</h5>

    <h5 class="mt-3">Totaux par produit</h5>
    <table class="table table-sm">
      <thead><tr><th>Produit</th><th>Quantité vendue</th><th>Montant total</th></tr></thead>
      <tbody>
      {% for pid, info in totals.items() %}
        <tr><td>{{info.name}}</td><td>{{info.qty}}</td><td>{{ '%.2f' % info.total }} €</td></tr>
      {% endfor %}
      </tbody>
    </table>

    <h5 class="mt-3">Historique des commandes</h5>
    <table class="table">
      <thead><tr><th>#</th><th>Time (UTC)</th><th>Items</th><th>Total</th></tr></thead>
      <tbody>
        {% for o in orders %}
        <tr>
          <td>{{o.id}}</td>
          <td>{{o.created_at}}</td>
          <td>
            <ul>
            {% for it in o["items"] %}
              <li>{{it.name}} x{{it.qty}}</li>
            {% endfor %}
            </ul>
          </td>
          <td>{{'%.2f' % o.total}} €</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% endif %}
{% endblock %}
